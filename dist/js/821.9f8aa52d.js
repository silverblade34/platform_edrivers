"use strict";(self["webpackChunktemplate_vue_platform"]=self["webpackChunktemplate_vue_platform"]||[]).push([[821],{4821:function(e,a,t){t.r(a),t.d(a,{default:function(){return X}});var o=t(3396),l=t(11),n=t(1888),r=t(3601),i=t(7325);const s={class:"flex justify-between"},d=(0,o._)("h1",{class:"font-bold lg:text-2xl text-xl text-gray-400"},"Compañias",-1),u={class:"py-5"};function m(e,a,t,m,c,p){const v=(0,o.up)("ModalCreateCustomerVue"),g=(0,o.up)("TableCustomersVue"),w=(0,o.up)("ModalEditCustomerVue");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",s,[d,(0,o.Wm)(v,{onCreateItem:m.onCreateItem},null,8,["onCreateItem"])]),(0,o._)("div",u,[(0,o.Wm)(g,{desserts:m.dataCompanies,onEditItem:m.onEditItem,onDeleteItem:m.onDeleteItem},null,8,["desserts","onEditItem","onDeleteItem"])]),(0,o.Wm)(w,{itemEdit:m.itemEdit,openModal:m.dialogEdit,onCancelItem:a[0]||(a[0]=e=>m.dialogEdit=!1),onEditItem:m.onUpdateItem},null,8,["itemEdit","openModal","onEditItem"]),(0,o.Wm)(r.B,{modelValue:m.dialogLoader,"onUpdate:modelValue":a[1]||(a[1]=e=>m.dialogLoader=e),scrim:!1,persistent:"",width:"auto"},{default:(0,o.w5)((()=>[(0,o.Wm)(l._,{color:"indigo"},{default:(0,o.w5)((()=>[(0,o.Wm)(n.Z,null,{default:(0,o.w5)((()=>[(0,o.Uk)(" Procesando... "),(0,o.Wm)(i.K,{indeterminate:"",color:"white",class:"mb-0"})])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}var c=t(4870),p=t(3512),v=t(3041);const g="http://204.48.17.106:3020/api/v1";function w(e){return v.Z.get(`${g}/customers`,{headers:{Authorization:`Bearer ${e}`}})}function f(e,a){return v.Z.post(`${g}/customers`,e,{headers:{Authorization:`Bearer ${a}`}})}function h(e,a,t){return v.Z.patch(`${g}/customers/${t}`,e,{headers:{Authorization:`Bearer ${a}`}})}function y(e,a){return v.Z.delete(`${g}/customers/${a}`,{headers:{Authorization:`Bearer ${e}`}})}function C(e,a){return v.Z.get(`${g}/customers/findAllRecourses/${a}`,{headers:{Authorization:`Bearer ${e}`}})}function k(e,a){return v.Z.post(`${g}/customers/asignRecourse`,e,{headers:{Authorization:`Bearer ${a}`}})}var I=t(870),_=t(1334),b=t(8521),V=t(9234),W=t(3289),E=t(165),U=t(1328);const H=(0,o._)("span",{class:"px-4 w-full text-center text-indigo-500 font-bold title_views"},"CREAR COMPAÑIA",-1);function x(e,a,t,i,s,d){return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(I.T,{size:"small",class:"text-none",color:"indigo-darken-1",onClick:a[0]||(a[0]=e=>i.dialog=!0)},{default:(0,o.w5)((()=>[(0,o.Wm)(W.t,{icon:"mdi-plus"}),(0,o.Uk)(" Nuevo")])),_:1}),(0,o.Wm)(r.B,{modelValue:i.dialog,"onUpdate:modelValue":a[5]||(a[5]=e=>i.dialog=e),width:"550","onClick:outside":i.closeItem},{default:(0,o.w5)((()=>[(0,o.Wm)(l._,null,{default:(0,o.w5)((()=>[(0,o.Wm)(U.i,null,{default:(0,o.w5)((()=>[H])),_:1}),(0,o.Wm)(n.Z,null,{default:(0,o.w5)((()=>[(0,o.Wm)(b.D,{cols:"12"},{default:(0,o.w5)((()=>[(0,o.Wm)(E.h,{variant:"outlined",label:"Nombre",color:"indigo",modelValue:i.name,"onUpdate:modelValue":a[1]||(a[1]=e=>i.name=e),"prepend-inner-icon":"mdi-text"},null,8,["modelValue"]),(0,o.Wm)(E.h,{variant:"outlined",label:"Usuario","prepend-inner-icon":"mdi-account",color:"indigo",modelValue:i.username,"onUpdate:modelValue":a[2]||(a[2]=e=>i.username=e)},null,8,["modelValue"]),(0,o.Wm)(E.h,{variant:"outlined",label:"Contraseña","prepend-inner-icon":"mdi-lock",color:"indigo",modelValue:i.password,"onUpdate:modelValue":a[3]||(a[3]=e=>i.password=e)},null,8,["modelValue"]),(0,o.Wm)(E.h,{variant:"outlined",label:"Codigo de compañia","prepend-inner-icon":"mdi-barcode",color:"indigo",modelValue:i.codecompany,"onUpdate:modelValue":a[4]||(a[4]=e=>i.codecompany=e)},null,8,["modelValue"])])),_:1})])),_:1}),(0,o.Wm)(_.h,null,{default:(0,o.w5)((()=>[(0,o.Wm)(V.C),(0,o.Wm)(I.T,{color:"blue-grey-lighten-2",variant:"tonal",onClick:i.closeItem},{default:(0,o.w5)((()=>[(0,o.Uk)(" Cancelar ")])),_:1},8,["onClick"]),(0,o.Wm)(I.T,{color:"blue-lighten-1",variant:"tonal",onClick:i.createItem},{default:(0,o.w5)((()=>[(0,o.Uk)(" Aceptar ")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue","onClick:outside"])],64)}var Z={emits:["create-item"],setup(e,{emit:a}){const t=(0,c.iH)(!1),o=(0,c.iH)(""),l=(0,c.iH)(""),n=(0,c.iH)(""),r=(0,c.iH)(""),i=()=>{a("create-item",{name:o.value,username:l.value,password:n.value,codecompany:r.value}),s()},s=()=>{t.value=!1,o.value=l.value=n.value=r.value=""};return{dialog:t,name:o,username:l,password:n,codecompany:r,createItem:i,closeItem:s}}},A=t(89);const $=(0,A.Z)(Z,[["render",x]]);var D=$,R=t(678);const T={class:"flex gap-1 justify-center"},M=["onClick"],z=["onClick"];function B(e,a,t,l,n,r){const i=(0,o.up)("v-data-table");return(0,o.wg)(),(0,o.j4)(i,{headers:n.headers,items:t.desserts,class:"elevation-1 text-sm"},{["item.actions"]:(0,o.w5)((({item:e})=>[(0,o._)("div",T,[(0,o._)("span",{onClick:a=>l.editItem(e)},[(0,o.Wm)(I.T,{icon:"mdi-pencil",size:"small",variant:"text",color:"green"}),(0,o.Wm)(R.N,{activator:"parent",location:"top"},{default:(0,o.w5)((()=>[(0,o.Uk)("Editar")])),_:1})],8,M),(0,o._)("span",{onClick:a=>l.deleteItem(e)},[(0,o.Wm)(I.T,{icon:"mdi-delete-empty",size:"small",variant:"text",color:"red"}),(0,o.Wm)(R.N,{activator:"parent",location:"top"},{default:(0,o.w5)((()=>[(0,o.Uk)("Eliminar")])),_:1})],8,z)])])),_:2},1032,["headers","items"])}var L=t(5557),j={props:{desserts:Array},components:{VDataTable:L.y_},emits:["delete-item","edit-item"],data(){return{headers:[{title:"Nombre",align:"start",key:"name"},{title:"Usuario",align:"start",key:"user.username"},{title:"Codigo de compañia",key:"codecompany"},{title:"Codigo de recurso(Wialon)",align:"start",key:"recourseId"},{title:"Acciones",align:"center",key:"actions"}]}},setup(e,{emit:a}){const t=e=>{a("edit-item",{item:e})},o=e=>{a("delete-item",e)},l=e=>{const a={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"},t=new Date(e).toLocaleDateString("es-PE",a);return t};return{formatCreatedAt:l,editItem:t,deleteItem:o}}};const N=(0,A.Z)(j,[["render",B]]);var P=N,O=t(240);const S=(0,o._)("span",{class:"px-4 w-full text-center text-blue-500 font-bold title_views"},"EDITAR COMPAÑIA",-1);function Y(e,a,t,i,s,d){return(0,o.wg)(),(0,o.j4)(r.B,{modelValue:i.dialog,"onUpdate:modelValue":a[4]||(a[4]=e=>i.dialog=e),width:"550","onClick:outside":i.closeItem},{default:(0,o.w5)((()=>[(0,o.Wm)(l._,null,{default:(0,o.w5)((()=>[(0,o.Wm)(U.i,null,{default:(0,o.w5)((()=>[S])),_:1}),(0,o.Wm)(n.Z,null,{default:(0,o.w5)((()=>[(0,o.Wm)(b.D,{cols:"12"},{default:(0,o.w5)((()=>[(0,o.Wm)(E.h,{variant:"outlined",label:"Nombre",color:"blue",modelValue:i.name,"onUpdate:modelValue":a[0]||(a[0]=e=>i.name=e),"prepend-inner-icon":"mdi-text"},null,8,["modelValue"]),(0,o.Wm)(E.h,{variant:"outlined",label:"Usuario","prepend-inner-icon":"mdi-account",color:"blue",modelValue:i.username,"onUpdate:modelValue":a[1]||(a[1]=e=>i.username=e)},null,8,["modelValue"]),(0,o.Wm)(E.h,{variant:"outlined",label:"Contraseña","prepend-inner-icon":"mdi-lock",color:"blue",modelValue:i.password,"onUpdate:modelValue":a[2]||(a[2]=e=>i.password=e)},null,8,["modelValue"]),(0,o.Wm)(O.rL,{items:i.recourses,label:"Recursos","item-text":"name","item-value":"recourseId",modelValue:i.selectedRecourse,"onUpdate:modelValue":a[3]||(a[3]=e=>i.selectedRecourse=e),disabled:i.loadingRecourses},null,8,["items","modelValue","disabled"])])),_:1})])),_:1}),(0,o.Wm)(_.h,null,{default:(0,o.w5)((()=>[(0,o.Wm)(V.C),(0,o.Wm)(I.T,{color:"blue-grey-lighten-2",variant:"tonal",onClick:i.closeItem},{default:(0,o.w5)((()=>[(0,o.Uk)(" Cancelar ")])),_:1},8,["onClick"]),(0,o.Wm)(I.T,{color:"blue-lighten-1",variant:"tonal",onClick:i.editItem,disabled:i.loadingRecourses},{default:(0,o.w5)((()=>[(0,o.Uk)(" Aceptar ")])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})])),_:1},8,["modelValue","onClick:outside"])}var q=t(4239),K={props:{itemEdit:Object,openModal:Boolean},emits:["edit-item","cancel-item"],setup(e,{emit:a}){const t=(0,c.iH)(!1),l=(0,c.iH)(""),n=(0,c.iH)(""),r=(0,c.iH)(""),i=(0,c.iH)(""),s=(0,c.iH)(""),d=(0,c.iH)([]),u=(0,c.iH)(null),m=(0,c.iH)(!1);(0,o.YP)((()=>e.openModal),(e=>{t.value=e})),(0,o.YP)((()=>e.itemEdit),(async e=>{0!==Object.keys(e).length&&(l.value=e.item.id,n.value=e.item.name,r.value=e.item.user.username,i.value=e.item.user.password,s.value=e.item.codecompany,u.value=e.item.recourseId,await p(e.item.id))}));const p=async e=>{d.value=[],m.value=!0;try{const a=await C(q.Z.state.token,e);console.log("Recourses response:",a.data),d.value=a.data.data.map((e=>e.recourseId))}catch(a){console.error("Error loading recourses:",a)}finally{m.value=!1}},v=async()=>{try{const e={customerId:l.value,recourseId:u.value};await k(e,q.Z.state.token),console.log("Recurso asignado correctamente")}catch(e){console.error("Error asignando recurso:",e)}},g=async()=>{a("edit-item",{id:l.value,name:n.value,username:r.value,password:i.value,codecompany:s.value,recourseId:u.value}),await v(),w()},w=()=>{a("cancel-item")};return{dialog:t,name:n,id:l,username:r,password:i,codecompany:s,recourses:d,selectedRecourse:u,loadingRecourses:m,editItem:g,closeItem:w}}};const F=(0,A.Z)(K,[["render",Y]]);var G=F,J={components:{ModalCreateCustomerVue:D,ModalEditCustomerVue:G,TableCustomersVue:P},setup(){const e=(0,c.iH)([]),a=(0,c.iH)({}),t=(0,c.iH)(!1),l=(0,c.iH)(null),n=(0,c.iH)(!1);(0,o.bv)((()=>{i()}));const r=async e=>{n.value=!0,""!==e.name&&""!==e.username&&""!==e.password&&""!==e.codecompany?await f(e,q.Z.state.token).then((()=>{n.value=!1,(0,p.y)((()=>{i()}),"success","Logrado","Se ha creado correctamente")})).catch((e=>{n.value=!1,(0,p.y)((()=>{}),"error","Error",e.response.data.message)})):(n.value=!1,(0,p.y)((()=>{}),"warning","Error","Los campos no deben estar vacíos"))},i=async()=>{const a=await w(q.Z.state.token);e.value=a.data.data},s=e=>{t.value=!0,a.value=e},d=e=>{l.value=e,(0,p.M)((async()=>{await u()}),"¿Estás seguro de que deseas eliminar esta compañía?","Eliminar")},u=async()=>{l.value&&await y(q.Z.state.token,l.value.id).then((()=>{(0,p.y)((()=>{i()}),"success","Logrado","Se ha eliminado correctamente")})).catch((e=>{(0,p.y)((()=>{}),"error","Error",e.message)})).finally((()=>{l.value=null}))},m=async e=>{""!==e.name&&""!==e.username&&""!==e.password&&""!==e.codecompany?await h(e,q.Z.state.token,e.id).then((()=>{(0,p.y)((()=>{i(),t.value=!1}),"success","Logrado","Se ha actualizado correctamente")})).catch((e=>{(0,p.y)((()=>{}),"error","Error",e.message)})):(0,p.y)((()=>{}),"warning","Error","Los campos no deben estar vacíos")};return{dialogEdit:t,dataCompanies:e,dialogLoader:n,itemEdit:a,itemToDelete:l,onUpdateItem:m,onDeleteItem:d,onCreateItem:r,onEditItem:s,confirmDelete:u}}};const Q=(0,A.Z)(J,[["render",m]]);var X=Q}}]);
//# sourceMappingURL=821.9f8aa52d.js.map